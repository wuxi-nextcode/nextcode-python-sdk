<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>Building queries with the Python SDK &#8212; nextcode-python-sdk 0.8.10 documentation</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/css/custom.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Server API Documention" href="apidoc.html" />
    <link rel="prev" title="Basic facilities" href="api_basic.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          nextcode-python-sdk</a>
        <span class="navbar-text navbar-version pull-left"><b>0.8.10</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Contents <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="jupyter.html">Jupyter Notebooks Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Building queries with the Python SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="apidoc.html">Server API Documention</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Developer information</a></li>
<li class="toctree-l1"><a class="reference internal" href="local_workflows.html">Running a local workflow</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Building queries with the Python SDK</a><ul>
<li><a class="reference internal" href="#Simple-single-line-gor-expression">Simple single-line gor expression</a></li>
<li><a class="reference internal" href="#Single-line-gor-expression-which-stores-results-in-local-variable">Single-line gor expression which stores results in local variable</a></li>
<li><a class="reference internal" href="#Simple-multi-line-gor-expression">Simple multi-line gor expression</a></li>
<li><a class="reference internal" href="#Multi-line-gor-expression-which-stores-results-in-local-variable">Multi-line gor expression which stores results in local variable</a></li>
<li><a class="reference internal" href="#Store-results-in-the-user_data-folder">Store results in the user_data folder</a><ul>
<li><a class="reference internal" href="#Download-results-to-a-local-file">Download results to a local file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Gor-expression-which-references-a-local-variable">Gor expression which references a local variable</a></li>
<li><a class="reference internal" href="#Gor-expression-with-defs-and-create-statements">Gor expression with defs and create statements</a></li>
<li><a class="reference internal" href="#Compound-expressions">Compound expressions</a></li>
<li><a class="reference internal" href="#Virtual-relations">Virtual relations</a></li>
<li><a class="reference internal" href="#Cancelling-queries">Cancelling queries</a><ul>
<li><a class="reference internal" href="#Using-the-SDK-without-magic-syntax">Using the SDK without magic syntax</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Initializing-the-SDK">Initializing the SDK</a></li>
<li><a class="reference internal" href="#Running-basic-queries">Running basic queries</a></li>
<li><a class="reference internal" href="#Analysing-failed-queries">Analysing failed queries</a></li>
<li><a class="reference internal" href="#Using-virtual-relations">Using virtual relations</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="api_basic.html" title="Previous Chapter: Basic facilities"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Basic facilities</span>
    </a>
  </li>
  <li>
    <a href="apidoc.html" title="Next Chapter: Server API Documention"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Server API Do... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Building-queries-with-the-Python-SDK">
<h1>Building queries with the Python SDK<a class="headerlink" href="#Building-queries-with-the-Python-SDK" title="Permalink to this headline">¶</a></h1>
<p>In the following notebook, we will show how to build complex queries in GOR using the Python SDK to connect to our instance. First, as always, we load the gor magic extension to be able to use the <code class="docutils literal notranslate"><span class="pre">%gor</span></code> and <code class="docutils literal notranslate"><span class="pre">%%gor</span></code> syntax. This notebook assumes you are familiar with the gor syntax.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Install the python sdk, if needed</span>
<span class="o">!</span> pip install nextcode-sdk<span class="o">[</span>jupyter<span class="o">]</span> -U &gt; /dev/null
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># load the magic extension and imports</span>
<span class="o">%</span><span class="k">reload_ext</span> nextcode
<span class="kn">import</span> <span class="nn">nextcode</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="o">%</span><span class="k">env</span> LOG_QUERY=1
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
 Gor magic extension has been loaded. You can now use &#39;%gor&#39; and &#39;%%gor&#39; in this notebook
 * Python SDK Version: 0.8.1
 * Query API Version: 1.10.0
 * GOR Version: 2.6.0 (git SHA 622555a)
 * Root Endpoint: https://platform.wuxinextcodedev.com/api/query/
 * Current User: jonb@wuxinextcode.com
 * Current Project: ukbb_hg38 (%env GOR_API_PROJECT=xxx)
env: LOG_QUERY=1
</pre></div></div>
</div>
<div class="section" id="Simple-single-line-gor-expression">
<h2>Simple single-line gor expression<a class="headerlink" href="#Simple-single-line-gor-expression" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">gor</span> nor #dbsnp# | top 2
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Query 19503 generated 2 rows in 0.84 sec
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Chrom</th>
      <th>pos</th>
      <th>reference</th>
      <th>allele</th>
      <th>rsids</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>chr1</td>
      <td>10020</td>
      <td>AA</td>
      <td>A</td>
      <td>rs775809821</td>
    </tr>
    <tr>
      <th>1</th>
      <td>chr1</td>
      <td>10039</td>
      <td>A</td>
      <td>C</td>
      <td>rs978760828</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="Single-line-gor-expression-which-stores-results-in-local-variable">
<h2>Single-line gor expression which stores results in local variable<a class="headerlink" href="#Single-line-gor-expression-which-stores-results-in-local-variable" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">var</span> <span class="o">=</span> <span class="o">%</span><span class="k">gor</span> nor #dbsnp# | top 2
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Query 19504 generated 2 rows in 0.73 sec
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
  Chrom    pos reference allele        rsids
0  chr1  10020        AA      A  rs775809821
1  chr1  10039         A      C  rs978760828
</pre></div></div>
</div>
</div>
<div class="section" id="Simple-multi-line-gor-expression">
<h2>Simple multi-line gor expression<a class="headerlink" href="#Simple-multi-line-gor-expression" title="Permalink to this headline">¶</a></h2>
<p>Multi-line expressions are started with <code class="docutils literal notranslate"><span class="pre">%%</span></code>. Each statement should end with <code class="docutils literal notranslate"><span class="pre">;</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">gor</span>
  def #top# = 2;
  gor #dbsnp#
   | top #top#;
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Query 19505 generated 2 rows in 0.77 sec
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Chrom</th>
      <th>pos</th>
      <th>reference</th>
      <th>allele</th>
      <th>rsids</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>chr1</td>
      <td>10020</td>
      <td>AA</td>
      <td>A</td>
      <td>rs775809821</td>
    </tr>
    <tr>
      <th>1</th>
      <td>chr1</td>
      <td>10039</td>
      <td>A</td>
      <td>C</td>
      <td>rs978760828</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="Multi-line-gor-expression-which-stores-results-in-local-variable">
<h2>Multi-line gor expression which stores results in local variable<a class="headerlink" href="#Multi-line-gor-expression-which-stores-results-in-local-variable" title="Permalink to this headline">¶</a></h2>
<p>To load results from a multi-line gor expression into a variable you can use the special <code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code> operator</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">gor</span> new_results &lt;&lt;
def #tops# = 10;
gor #dbsnp# | top #tops#;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Query 19506 generated 10 rows in 0.86 sec
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">new_results</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RangeIndex(start=0, stop=10, step=1)
</pre></div></div>
</div>
</div>
<div class="section" id="Store-results-in-the-user_data-folder">
<h2>Store results in the user_data folder<a class="headerlink" href="#Store-results-in-the-user_data-folder" title="Permalink to this headline">¶</a></h2>
<p>Instead of fetching the data to the jupyter server you can also use the | write gor command to store files in the user_data folder within the project on NFS.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">gor</span>
  pgor #dbsnp#
   | top 1000
   | write user_data/outfile.gorz;
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Query 19507 generated 0 rows in 0.86 sec
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># verify that the file is there by executing gorls</span>
<span class="o">%</span><span class="k">gorls</span> user_data outfile.gorz
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
outfile.gorz (10.2KiB)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># now you can gor this file and bring the results into a local dataframe</span>
<span class="o">%</span><span class="k">gor</span> user_data/outfile.gorz | GROUP chrom -count | top 2
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Query 19509 generated 1 rows in 0.73 sec
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Chrom</th>
      <th>bpStart</th>
      <th>bpStop</th>
      <th>allCount</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>chr7</td>
      <td>0</td>
      <td>159345973</td>
      <td>1000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="section" id="Download-results-to-a-local-file">
<h3>Download results to a local file<a class="headerlink" href="#Download-results-to-a-local-file" title="Permalink to this headline">¶</a></h3>
<p>When the results are very large and you want to be able to use them locally without rerunning the query you can stream the results directly to a file with the &lt;&lt; operator by specifying <code class="docutils literal notranslate"><span class="pre">file:</span></code>. You can cancel the download at any time and have partial results in the output file.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;dbsnp_2m.tsv&quot;</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">gor</span> file:$filename &lt;&lt;
    gor #dbsnp# | top 2000000
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>wc -l <span class="nv">$filename</span>
<span class="o">!</span>ls -lh <span class="nv">$filename</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Gor-expression-which-references-a-local-variable">
<h2>Gor expression which references a local variable<a class="headerlink" href="#Gor-expression-which-references-a-local-variable" title="Permalink to this headline">¶</a></h2>
<p>Local variables can be references using the <code class="docutils literal notranslate"><span class="pre">$xxx</span></code> syntax. This will expand the variable inline and is meant to be used for simple strings and numbers</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">num</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">gor</span>
  gor -p chr1:69000-70000 #dbsnp#
   | TOP $num;
</pre></div>
</div>
</div>
</div>
<div class="section" id="Gor-expression-with-defs-and-create-statements">
<h2>Gor expression with defs and create statements<a class="headerlink" href="#Gor-expression-with-defs-and-create-statements" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">gor</span>
def #number# = $num;
def #VEP_single# = UKBB/freezes/2019_0325/plink_wes/vep_single.gorz;
def #myfavouritefood# = pizza;

create mydbsnp = gor -p chr1:69000-70000 #dbsnp#
                  | TOP #number#;

gor [mydbsnp];
</pre></div>
</div>
</div>
</div>
<div class="section" id="Compound-expressions">
<h2>Compound expressions<a class="headerlink" href="#Compound-expressions" title="Permalink to this headline">¶</a></h2>
<p>Using the local variables you can construct compount expressions, allowing you to split up long gor scripts.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">defs</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">def #myfirstdef# = 2;</span>
<span class="s2">def #myseconddef# = 2;</span>

<span class="s2">&quot;&quot;&quot;</span>
<span class="n">creates</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">create mydbsnp = gor -p chr1:69000-70000 #dbsnp#</span>
<span class="s2">                  | TOP #myfirstdef#;</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">gor</span>
 $defs
 $creates

 gor [mydbsnp];
</pre></div>
</div>
</div>
</div>
<div class="section" id="Virtual-relations">
<h2>Virtual relations<a class="headerlink" href="#Virtual-relations" title="Permalink to this headline">¶</a></h2>
<p>You can load pandas dataframes into the query with the special <code class="docutils literal notranslate"><span class="pre">[var:xxx]</span></code> syntax.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">allpns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;pnlist.tsv&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">gor</span>
  create bla = gor #dbsnp#
   | top 10;
  nor [var:allpns]
   | top 5;
</pre></div>
</div>
</div>
</div>
<div class="section" id="Cancelling-queries">
<h2>Cancelling queries<a class="headerlink" href="#Cancelling-queries" title="Permalink to this headline">¶</a></h2>
<p>Try executing this long-running query and then click the stop button</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">results</span> <span class="o">=</span> <span class="o">%</span><span class="k">gor</span> pgor #dbsnp# | GROUP chrom -count
</pre></div>
</div>
</div>
<div class="section" id="Using-the-SDK-without-magic-syntax">
<h3>Using the SDK without magic syntax<a class="headerlink" href="#Using-the-SDK-without-magic-syntax" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">%</span></code> and <code class="docutils literal notranslate"><span class="pre">%%</span></code> is simply syntactic sugar for executing queries through the python sdk. You can use the sdk directly as well and that is probably the preferred method for serious analysis.</p>
</div>
</div>
<div class="section" id="Initializing-the-SDK">
<h2>Initializing the SDK<a class="headerlink" href="#Initializing-the-SDK" title="Permalink to this headline">¶</a></h2>
<p>The SDK usually needs to be initialized with an API key and a project. However, in Wuxi notebooks this has already been done for you.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#%env GOR_API_KEY=[jwt token]</span>
<span class="c1">#%env GOR_API_PROJECT=[project name]</span>
<span class="kn">import</span> <span class="nn">nextcode</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="c1"># get a handle on a query service proxy</span>
<span class="n">svc</span> <span class="o">=</span> <span class="n">nextcode</span><span class="o">.</span><span class="n">get_service</span><span class="p">(</span><span class="s2">&quot;query&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Running-basic-queries">
<h2>Running basic queries<a class="headerlink" href="#Running-basic-queries" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">qry</span> <span class="o">=</span> <span class="n">svc</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;gor #dbsnp# | top 2;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Query </span><span class="si">{</span><span class="n">qry</span><span class="o">.</span><span class="n">query_id</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">qry</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">. Runtime was </span><span class="si">{</span><span class="n">qry</span><span class="o">.</span><span class="n">duration</span><span class="si">}</span><span class="s2"> ms and it produced </span><span class="si">{</span><span class="n">qry</span><span class="o">.</span><span class="n">line_count</span><span class="si">}</span><span class="s2"> rows.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The query that was run: </span><span class="si">{</span><span class="n">qry</span><span class="o">.</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">qry</span><span class="o">.</span><span class="n">dataframe</span><span class="p">()</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Analysing-failed-queries">
<h2>Analysing failed queries<a class="headerlink" href="#Analysing-failed-queries" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">qry</span> <span class="o">=</span> <span class="n">svc</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;gor #unknowndef# | top 2;&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">qry</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;FAILED&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Query failed with error: </span><span class="si">{</span><span class="n">qry</span><span class="o">.</span><span class="n">error</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Additional information available from qry.error[]: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">qry</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Using-virtual-relations">
<h2>Using virtual relations<a class="headerlink" href="#Using-virtual-relations" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">nextcode</span>
<span class="n">svc</span> <span class="o">=</span> <span class="n">nextcode</span><span class="o">.</span><span class="n">get_service</span><span class="p">(</span><span class="s2">&quot;query&quot;</span><span class="p">)</span>

<span class="c1"># use a dataframe as a virtual relation</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="s2">&quot;world&quot;</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span>
<span class="n">qry</span> <span class="o">=</span> <span class="n">svc</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;gor [test]&quot;</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">qry</span><span class="o">.</span><span class="n">dataframe</span><span class="p">())</span>

<span class="c1"># use a tsv string as a virtual relation</span>
<span class="n">tsv</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;hello</span><span class="se">\t</span><span class="s2">world</span><span class="se">\n</span><span class="s2">1</span><span class="se">\t</span><span class="s2">2&quot;&quot;&quot;</span>
<span class="n">qry</span> <span class="o">=</span> <span class="n">svc</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;gor [test]&quot;</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="n">tsv</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">qry</span><span class="o">.</span><span class="n">dataframe</span><span class="p">())</span>

<span class="c1"># if your virtual relation uses special characters (:) in variable name</span>
<span class="n">qry</span> <span class="o">=</span> <span class="n">svc</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;gor [var:test]&quot;</span><span class="p">,</span> <span class="n">relations</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;var:test&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">df</span><span class="p">}])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">qry</span><span class="o">.</span><span class="n">dataframe</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/notebook.ipynb.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2020, Wuxi Nextcode.<br/>
      Last updated on 2020-06-22.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>